"use strict";(self["webpackChunktoutiao_two"]=self["webpackChunktoutiao_two"]||[]).push([[43],{9043:function(t,e,s){s.r(e),s.d(e,{default:function(){return at}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"黑马头条"},scopedSlots:t._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"arrow-left"},on:{click:function(e){return t.$router.back()}}})]},proxy:!0}])}),e("div",{staticClass:"main-wrap"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("加载中")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",attrs:{center:"",border:!1}},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),e("div",{staticClass:"user-name",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.aut_name))]),e("div",{staticClass:"publish-date",attrs:{slot:"label"},slot:"label"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))]),e("FollowUser",{staticClass:"follow-btn",attrs:{"user-id":t.article.aut_id},model:{value:t.article.is_followed,callback:function(e){t.$set(t.article,"is_followed",e)},expression:"article.is_followed"}})],1),e("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("CommentList",{attrs:{source:t.article.art_id,list:t.addCommentList},on:{"onload-success":function(e){t.totalCommentCount=e.total_count},"reply-click":t.onReplyClick}}),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.isCommentShow=!0}}},[t._v("写评论")]),e("van-icon",{attrs:{name:"comment-o",info:t.totalCommentCount,color:"#777"}}),e("CollectArticle",{attrs:{"article-id":t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),e("LinkArticle",{attrs:{"article-id":t.article.art_id},model:{value:t.article.attitude,callback:function(e){t.$set(t.article,"attitude",e)},expression:"article.attitude"}}),e("van-icon",{attrs:{name:"share",color:"#777777"}})],1)],1):404===t.errStatus?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.loadArticle}},[t._v("点击重试")])],1)]),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isCommentShow,callback:function(e){t.isCommentShow=e},expression:"isCommentShow"}},[e("CommentPost",{attrs:{target:t.article.art_id},on:{"post-success":t.onPostSuccess}})],1),e("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("CommentReply",{attrs:{comment:t.currentComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},i=[],n=s(8572),a=s(514),l=function(){var t=this,e=t._self._c;return t.isFollowed?e("van-button",{staticClass:"follow-btn",attrs:{loading:t.followLoading,round:"",size:"small"},on:{click:t.onFollow}},[t._v("已关注")]):e("van-button",{staticClass:"follow-btn",attrs:{loading:t.followLoading,type:"info",color:"#3296fa",round:"",size:"small",icon:"plus"},on:{click:t.onFollow}},[t._v("关注")])},r=[],c=s(2900),u=s(3822),m={name:"FollowUser",model:{prop:"isFollowed",event:"update-is_followed"},props:{isFollowed:{type:Boolean,required:!0},userId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1,followLoading:!1}},methods:{async onFollow(){this.followLoading=!0;try{this.isFollowed?(await(0,c.VR)(this.userId),this.$toast.success("取消成功")):(await(0,c.R3)(this.userId),this.user?this.$toast.success("关注成功"):this.$toast.success("您还未登录，请先登录")),this.$emit("update-is_followed",!this.isFollowed)}catch(t){let e="操作失败，请重试";t.response&&400===t.response.status&&(e="不能关注自己"),this.$toast(e)}this.followLoading=!1}},computed:{...(0,u.rn)(["user"])}},d=m,h=s(1001),p=(0,h.Z)(d,l,r,!1,null,null,null),f=p.exports,v=function(){var t=this,e=t._self._c;return e("van-icon",{attrs:{color:t.isCollected?"#ffa500":"",name:t.isCollected?"star":"star-o",loading:t.loading},on:{click:t.onCollect}})},_=[],g={name:"CollectArticle",model:{prop:"isCollected",event:"update-is_collect"},props:{isCollected:{type:Boolean,required:!0},articleId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1}},methods:{async onCollect(){this.loading=!0;try{this.isCollected?(await(0,n.qI)(this.articleId),this.$toast.success("取消收藏")):(await(0,n._Y)(this.articleId),this.user?this.$toast.success("收藏成功"):this.$toast.success("您还未登录，请先登录")),this.$emit("update-is_collect",!this.isCollected)}catch(t){this.$toast.fail("操作失败，请重试")}this.loading=!0}},computed:{...(0,u.rn)(["user"])}},C=g,w=(0,h.Z)(C,v,_,!1,null,null,null),b=w.exports,y=function(){var t=this,e=t._self._c;return e("van-icon",{attrs:{name:1===t.isAttitude?"good-job":"good-job-o",color:1===t.isAttitude?"#e5645f":"",loading:t.loading},on:{click:t.onLink}})},k=[],S={name:"LinkArticle",model:{prop:"isAttitude",event:"update-is_link"},props:{isAttitude:{type:Number,required:!0},articleId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1}},methods:{async onLink(){this.loading=!0;try{let t=-1;1===this.isAttitude?(await(0,n.Yw)(this.articleId),this.$toast.success("取消点赞")):(await(0,n.MJ)(this.articleId),t=1,this.user?this.$toast.success("点赞成功"):this.$toast.success("您还未登录，请先登录")),this.$emit("update-is_link",t)}catch(t){this.$toast.fail("操作失败，请重试")}this.loading=!0}},computed:{...(0,u.rn)(["user"])}},$=S,L=(0,h.Z)($,y,k,!1,null,null,null),Z=L.exports,P=function(){var t=this,e=t._self._c;return e("van-list",{attrs:{finished:t.finished,error:t.error,"error-text":"请求失败，点击重新加载","finished-text":"没有更多了","immediate-check":!1},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(s,o){return e("comment-item",{key:o,attrs:{comment:s},on:{"reply-click":function(e){return t.$emit("reply-click",e)}}})})),1)},x=[],I=s(4471);const T=t=>(0,I.Z)({method:"GET",url:"/v1_0/comments",params:t}),E=t=>(0,I.Z)({method:"POST",url:"/v1_0/comment/likings",data:{target:t}}),A=t=>(0,I.Z)({method:"DELETE",url:`/v1_0/comment/likings/${t}`}),j=t=>(0,I.Z)({method:"POST",url:"/v1_0/comments",data:t});var R=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item"},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:"https://img.yzcdn.cn/vant/cat.jpeg"},slot:"icon"}),e("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"user-name"},[t._v(t._s(t.comment.aut_name))]),e("van-button",{staticClass:"like-btn",class:{liked:t.comment.is_liking},attrs:{icon:t.comment.is_liking?"good-job":"good-job-o",liading:t.isCommentLoading},on:{click:t.onCommentLink}},[t._v(t._s(t.comment.like_count||"赞"))])],1),e("div",{attrs:{slot:"label"},slot:"label"},[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"bottom-info"},[e("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v("回复"+t._s(t.comment.reply_count))])],1)])],1)},q=[],O={name:"CommentItem",props:{comment:{type:Object,required:!0}},data(){return{isCommentLoading:!1}},methods:{async onCommentLink(){this.isCommentLoading=!0;try{this.comment.is_liking?(await A(this.comment.com_id),this.comment.like_count--):(await E(this.comment.com_id),this.comment.like_count++,this.user||this.$toast.success("您还未登录，请先登录")),this.comment.is_liking=!this.comment.is_liking}catch(t){}this.isCommentLoading=!0}},computed:{...(0,u.rn)(["user"])}},F=O,z=(0,h.Z)(F,R,q,!1,null,"05187930",null),G=z.exports,N={props:{source:{type:[Number,String,Object],required:!0},list:{type:Array,default:()=>[]},type:{type:String,validator(t){return["a","c"].includes(t)},default:"a"}},data(){return{loading:!1,finished:!1,error:!1,loading:!1,offset:null,limit:10}},created(){this.onLoad(),this.loading=!0},methods:{async onLoad(){try{const{data:t}=await T({type:this.type,source:this.source.toString(),offset:this.offset,limit:this.limit});console.log("获取文章评论",t);const{results:e}=t.data;this.$emit("onload-success",t.data),this.list.push(...e),this.loading=!1,e.length?this.offset=t.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}}},components:{CommentItem:G}},D=N,U=(0,h.Z)(D,P,x,!1,null,null,null),V=U.exports,Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-post"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",autofocus:!0,type:"textarea",maxlength:"500",placeholder:"请输入留言","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),e("van-button",{staticClass:"post-btn",attrs:{disabled:!t.message.length},on:{click:t.onPost}},[t._v("发布")])],1)},M=[],B={name:"CommentPost",inject:{articleId:{type:[Number,String,Object],default:null}},props:{target:{type:[Number,String,Object],required:!0}},data(){return{message:""}},methods:{async onPost(){this.$toast.loading({message:"发布中...",forbidClick:!0,duration:0});try{const{data:t}=await j({target:this.target.toString(),content:this.message,art_id:this.articleId?this.articleId.toString():null});console.log("评论内容",t),this.message="",this.$emit("post-success",t.data),this.$toast.success("发布成功")}catch(t){this.user?this.$toast.fail("发布失败"):this.$toast.success("您还未登录，请先登录")}}},computed:{...(0,u.rn)(["user"])}},H=B,J=(0,h.Z)(H,Y,M,!1,null,"a6c5a6ec",null),K=J.exports,Q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{attrs:{title:t.comment.reply_count>0?`${t.comment.reply_count}条评论`:"暂无回复"}},[e("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$emit("close")}},slot:"left"})],1),e("div",{staticClass:"scroll-wrap"},[e("CommentItem",{attrs:{comment:t.comment}}),e("van-cell",{attrs:{title:"全部回复"}}),e("CommentList",{attrs:{list:t.CommentList,source:t.comment.com_id,type:"c"}})],1),e("div",{staticClass:"post-wrap"},[e("van-button",{staticClass:"post-btn",attrs:{round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")])],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("CommentPost",{attrs:{target:t.comment.com_id},on:{"post-success":t.onPostSuccess}})],1)],1)},W=[],X={name:"CommentReply",props:{comment:{type:Object,required:!0}},components:{CommentItem:G,CommentList:V,CommentPost:K},data(){return{isPostShow:!1,CommentList:[]}},methods:{onPostSuccess(t){this.comment.reply_count++,this.isPostShow=!1,this.CommentList.unshift(t.new_obj)}}},tt=X,et=(0,h.Z)(tt,Q,W,!1,null,"68352234",null),st=et.exports,ot={name:"ArticleIndex",components:{FollowUser:f,FollowUser:f,CollectArticle:b,LinkArticle:Z,CommentList:V,CommentPost:K,CommentReply:st},provide:function(){return{articleId:this.articleId}},props:{articleId:{type:[Number,String],required:!0}},data(){return{article:{},loading:!0,errStatus:0,totalCommentCount:0,isCommentShow:!1,addCommentList:[],isReplyShow:!1,currentComment:{}}},created(){this.loadArticle()},methods:{async loadArticle(){this.loading=!0;try{const{data:t}=await(0,n.Vr)(this.articleId);console.log("获取文章数据",t),this.article=t.data,setTimeout((()=>{this.previewImage()}),0)}catch(t){t.response&&404===t.response.status&&(this.errStatus=404),console.log("获取数据失败",t)}this.loading=!1},previewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),s=[];e.forEach(((t,e)=>{s.push(t.src),t.onclick=()=>{(0,a.Z)({images:s,startPosition:e})}}))},onPostSuccess(t){this.isCommentShow=!1,this.addCommentList.unshift(t.new_obj)},onReplyClick(t){console.log(t),this.currentComment=t,this.isReplyShow=!0}}},it=ot,nt=(0,h.Z)(it,o,i,!1,null,"b39a7cdc",null),at=nt.exports},8572:function(t,e,s){s.d(e,{MJ:function(){return r},Vr:function(){return n},Yw:function(){return c},Zz:function(){return i},_Y:function(){return a},qI:function(){return l}});var o=s(4471);const i=t=>(0,o.Z)({method:"GET",url:"/v1_0/articles",params:t}),n=t=>(0,o.Z)({method:"GET",url:`/v1_0/articles/${t}`}),a=t=>(0,o.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),l=t=>(0,o.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),r=t=>(0,o.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),c=t=>(0,o.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`})},2900:function(t,e,s){s.d(e,{Ff:function(){return l},Ko:function(){return m},Q6:function(){return n},R3:function(){return r},VR:function(){return c},bG:function(){return a},et:function(){return u},x4:function(){return i}});var o=s(4471);console.log("用户请求相关模块",o.Z);const i=t=>(0,o.Z)({method:"POST",url:"/v1_0/authorizations",data:t}),n=t=>(0,o.Z)({method:"GET",url:`/v1_0/sms/codes/${t}`}),a=()=>(0,o.Z)({method:"GET",url:"/v1_0/user"}),l=()=>(0,o.Z)({method:"GET",url:"/v1_0/user/channels"}),r=t=>(0,o.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),c=t=>(0,o.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),u=()=>(0,o.Z)({method:"GET",url:"/v1_0/user/profile"}),m=t=>(0,o.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t})}}]);
//# sourceMappingURL=43.9fc3734b.js.map