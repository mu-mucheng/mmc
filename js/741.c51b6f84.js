"use strict";(self["webpackChunktoutiao_two"]=self["webpackChunktoutiao_two"]||[]).push([[741],{8741:function(t,e,a){a.r(e),a.d(e,{default:function(){return I}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[e("van-button",{staticClass:"search-btn",attrs:{slot:"title",type:"info",size:"small",round:"",icon:"search",to:{name:"search"}},slot:"title"},[t._v("搜索")])],1),e("van-tabs",{staticClass:"channel-tabs",attrs:{animated:"",swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channel,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("ArtcleList",{attrs:{channel:t}})],1)})),e("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),e("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isChannelEditShow=!0}},slot:"nav-right"},[e("i",{staticClass:"toutiao toutiao-gengduo"})])],2),e("van-popup",{style:{height:"100%"},attrs:{"close-icon-position":"top-left",closeable:"",position:"right"},model:{value:t.isChannelEditShow,callback:function(e){t.isChannelEditShow=e},expression:"isChannelEditShow"}},[e("ChannelEdit",{attrs:{active:t.active,myChannel:t.channel},on:{"update-active":t.onUpdateActive}})],1)],1)},s=[],i=a(2900),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-list"},[e("van-pull-refresh",{attrs:{"success-text":t.refreshSuccessText,"success-duration":1500},on:{refresh:t.onRefresh},model:{value:t.isreFreshLoading,callback:function(e){t.isreFreshLoading=e},expression:"isreFreshLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,a){return e("ArticleItem",{key:a,attrs:{article:t}})})),1)],1)],1)},r=[],o=a(8572),c=function(){var t=this,e=t._self._c;return e("div",[e("van-cell",{staticClass:"article-item",attrs:{to:"/article/"+t.article.art_id}},[e("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.title))]),e("div",{attrs:{slot:"label"},slot:"label"},[3===t.article.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(t,a){return e("div",{key:a,staticClass:"cover-item"},[e("van-image",{staticClass:"cover-item-img",attrs:{src:t}})],1)})),0):t._e(),e("div",{staticClass:"label-info-wrap"},[e("span",[t._v(t._s(t.article.aut_name))]),e("span",[t._v(t._s(t.article.comm_count)+"评论")]),e("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]),1===t.article.cover.type?e("van-image",{staticClass:"right-cover",attrs:{slot:"default",src:t.article.cover.images[0]},slot:"default"}):t._e()],1)],1)},h=[],d={name:"ArticleItem",props:{article:{type:Object,required:!0}},data(){return{}}},u=d,v=a(1001),m=(0,v.Z)(u,c,h,!1,null,"7b96eb04",null),f=m.exports,C={name:"ArticleList",props:{channel:{type:Object,required:!0}},data(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isreFreshLoading:!1,refreshSuccessText:"刷新成功"}},methods:{async onLoad(){try{const{data:t}=await(0,o.Zz)({channel_id:this.channel.id,timestamp:this.timestamp||Date.now()});console.log("获取文章",t);const{results:e}=t.data;this.list.push(...e),this.loading=!1,e.length?this.timestamp=t.data.pre_timestamp:this.finished=!0}catch(t){console.log(t),this.error=!0,this.loading=!1}},async onRefresh(){try{const{data:t}=await(0,o.Zz)({channel_id:this.channel.id,timestamp:Date.now()}),{results:e}=t.data;this.list.unshift(...e),this.isreFreshLoading=!1,this.refreshSuccessText=`刷新成功，更新了${e.length}条数据`}catch(t){this.refreshSuccessText="刷新失败",this.isreFreshLoading=!1}}},components:{ArticleItem:f}},p=C,_=(0,v.Z)(p,l,r,!1,null,"3734be80",null),g=_.exports,y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-edit"},[e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),e("van-button",{staticClass:"edit-btn",attrs:{size:"mini",round:"",type:"danger",plain:""},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(t._s(t.isEdit?"完成":"编辑"))])],1),e("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannel,(function(a,n){return e("van-grid-item",{key:n,staticClass:"grid-item",on:{click:function(e){return t.onMyChannelClick(a,n)}}},[e("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&!t.fixedChannel.includes(a.id),expression:"isEdit && !fixedChannel.includes(channel.id)"}],attrs:{slot:"icon",name:"clear"},slot:"icon"}),e("span",{staticClass:"text",class:{active:n===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name))])],1)})),1),e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("频道推荐")])]),e("van-grid",{staticClass:"recomment-grid",attrs:{gutter:10}},t._l(t.recommendChannel,(function(a){return e("van-grid-item",{key:a.id,staticClass:"grid-item",attrs:{icon:"plus",text:a.name},on:{click:function(e){return t.onAddChannel(a)}}})})),1)],1)},E=[],b=a(4471);const x=()=>(0,b.Z)({method:"GET",url:"/v1_0/channels"}),w=t=>(0,b.Z)({method:"PATCH",url:"/v1_0/user/channels",data:{channels:[t]}}),T=t=>(0,b.Z)({method:"DELETE",url:`/v1_0/user/channels/${t}`});var Z=a(3822),k=a(7247),A={name:"ChannelEdit",props:{myChannel:{type:Array,required:!0},active:{type:Number,required:!0}},data(){return{allChannels:[],isEdit:!1,fixedChannel:[0,11]}},created(){this.loadAllChannels()},methods:{async loadAllChannels(){try{const{data:t}=await x();console.log("获取所有频道",t),this.allChannels=t.data.channels}catch(t){this.$toast("数据获取失败")}},async onAddChannel(t){if(this.myChannel.push(t),this.user)try{await w({id:t.id,seq:this.myChannel.length})}catch(e){this.$toast("保存失败，请稍后再试"),console.log(e)}else(0,k.LS)("TOUTIAO_CHANNELS",this.myChannel)},onMyChannelClick(t,e){if(this.isEdit){if(this.fixedChannel.includes(t.id))return;this.myChannel.splice(e,1),e<=this.active&&this.$emit("update-active",this.active-1,!0),this.deleteChannel(t)}else this.$emit("update-active",e,!1)},async deleteChannel(t){try{this.user?await T(t.id):(0,k.LS)("TOUTIAO_CHANNELS",this.myChannels)}catch(e){this.$toast("操作失败，请稍后重试")}}},computed:{...(0,Z.rn)(["user"]),recommendChannel(){return this.allChannels.filter((t=>!this.myChannel.find((e=>e.id===t.id))))}}},L=A,S=(0,v.Z)(L,y,E,!1,null,"5e11c258",null),O=S.exports,$={name:"HomeIndex",data(){return{active:0,channel:[],isChannelEditShow:!1}},created(){this.loadChannels()},methods:{async loadChannels(){let t=[];if(this.user){const{data:e}=await(0,i.Ff)();t=e.data.channels}else{const e=(0,k.rV)("TOUTIAO_CHANNELS");if(e)t=e;else{const{data:e}=await(0,i.Ff)();t=e.data.channels}}this.channel=t},onUpdateActive(t,e=!0){this.active=t,this.isChannelEditShow=e}},components:{ArtcleList:g,ChannelEdit:O},computed:{...(0,Z.rn)(["user"])}},F=$,G=(0,v.Z)(F,n,s,!1,null,"253f3b7c",null),I=G.exports},8572:function(t,e,a){a.d(e,{MJ:function(){return o},Vr:function(){return i},Yw:function(){return c},Zz:function(){return s},_Y:function(){return l},qI:function(){return r}});var n=a(4471);const s=t=>(0,n.Z)({method:"GET",url:"/v1_0/articles",params:t}),i=t=>(0,n.Z)({method:"GET",url:`/v1_0/articles/${t}`}),l=t=>(0,n.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),r=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),o=t=>(0,n.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),c=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`})},2900:function(t,e,a){a.d(e,{Ff:function(){return r},Ko:function(){return d},Q6:function(){return i},R3:function(){return o},VR:function(){return c},bG:function(){return l},et:function(){return h},x4:function(){return s}});var n=a(4471);console.log("用户请求相关模块",n.Z);const s=t=>(0,n.Z)({method:"POST",url:"/v1_0/authorizations",data:t}),i=t=>(0,n.Z)({method:"GET",url:`/v1_0/sms/codes/${t}`}),l=()=>(0,n.Z)({method:"GET",url:"/v1_0/user"}),r=()=>(0,n.Z)({method:"GET",url:"/v1_0/user/channels"}),o=t=>(0,n.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),c=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),h=()=>(0,n.Z)({method:"GET",url:"/v1_0/user/profile"}),d=t=>(0,n.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t})}}]);
//# sourceMappingURL=741.c51b6f84.js.map